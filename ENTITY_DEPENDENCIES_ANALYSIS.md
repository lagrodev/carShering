# –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-12-04  
**–ü—Ä–æ–µ–∫—Ç**: Car Sharing Backend  
**–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É—â–Ω–æ—Å—Ç–µ–π**: 16

---

## üìä –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Mermaid)

```mermaid
erDiagram
    %% CORE AGGREGATES
    Client ||--o{ Contract : "—Å–æ–∑–¥–∞–µ—Ç"
    Client ||--o{ Favorite : "–∏–º–µ–µ—Ç"
    Client ||--o{ Document : "–≤–ª–∞–¥–µ–µ—Ç"
    Client ||--o{ RefreshToken : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç"
    Client ||--o{ VerificationCode : "–ø–æ–ª—É—á–∞–µ—Ç"
    Client }o--|| Role : "–∏–º–µ–µ—Ç —Ä–æ–ª—å"
    
    Car ||--o{ Contract : "–∞—Ä–µ–Ω–¥—É–µ—Ç—Å—è –≤"
    Car ||--o{ Favorite : "–≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º —É"
    Car ||--o{ Image : "–∏–º–µ–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
    Car }o--|| CarModel : "–æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –º–æ–¥–µ–ª–∏"
    Car }o--|| CarState : "–∏–º–µ–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
    
    Contract }o--|| Client : "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç"
    Contract }o--|| Car : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç"
    Contract }o--|| RentalState : "–∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å"
    
    %% CAR MODEL RELATIONSHIPS
    CarModel }o--|| Brand : "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –±—Ä–µ–Ω–¥—É"
    CarModel }o--|| Model : "–∏–º–µ–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ"
    CarModel }o--|| CarClass : "–æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–ª–∞—Å—Å—É"
    CarModel ||--o{ Car : "–∏–º–µ–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã"
    
    %% DOCUMENT RELATIONSHIPS
    Document }o--|| Client : "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç"
    Document }o--|| DocumentType : "–∏–º–µ–µ—Ç —Ç–∏–ø"
    
    %% FAVORITE RELATIONSHIPS
    Favorite }o--|| Client : "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç"
    Favorite }o--|| Car : "—Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞"
    
    %% AUTHENTICATION
    RefreshToken }o--|| Client : "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç"
    VerificationCode }o--|| Client : "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç"
    
    %% REFERENCE DATA
    Role ||--o{ Client : "–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞–º"
    RentalState ||--o{ Contract : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤"
    CarState ||--o{ Car : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤"
    Brand ||--o{ CarModel : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤"
    Model ||--o{ CarModel : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤"
    CarClass ||--o{ CarModel : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤"
    DocumentType ||--o{ Document : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤"
```

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 1Ô∏è‚É£ **RENTAL CONTEXT (–ö–æ–Ω—Ç–µ–∫—Å—Ç –∞—Ä–µ–Ω–¥—ã)** üî¥ CORE

#### Aggregate Root: **Contract**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Client` (ManyToOne) - –∫–ª–∏–µ–Ω—Ç, —Å–æ–∑–¥–∞–≤—à–∏–π –¥–æ–≥–æ–≤–æ—Ä
  - `Car` (ManyToOne) - –∞—Ä–µ–Ω–¥—É–µ–º—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
  - `RentalState` (ManyToOne) - —Å—Ç–∞—Ç—É—Å –¥–æ–≥–æ–≤–æ—Ä–∞
  - `Money` (Embedded) - —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–≥—Ä–µ–≥–∞—Ç–∞ `Client` - –Ω–∞—Ä—É—à–µ–Ω–∏–µ DDD
- ‚ùå –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–≥—Ä–µ–≥–∞—Ç–∞ `Car` - –Ω–∞—Ä—É—à–µ–Ω–∏–µ DDD
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥–æ–≤ (–∞–Ω–µ–º–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `ClientId` –∏ `CarId` (Value Objects)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã: `confirm()`, `cancel()`, `complete()`, `updatePeriod()`
- ‚úÖ –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç, —Å—Ç–∞—Ç—É—Å–æ–≤)

---

### 2Ô∏è‚É£ **FLEET CONTEXT (–ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ–ø–∞—Ä–∫–∞)** üîµ

#### Aggregate Root: **Car**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `CarModel` (ManyToOne) - –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è
  - `CarState` (ManyToOne) - —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–æ—Å—Ç—É–ø–µ–Ω/–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
  - `Money` (Embedded) - –¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∞—Ä–µ–Ω–¥—ã
  - `Contract` (OneToMany) - –∏—Å—Ç–æ—Ä–∏—è –∞—Ä–µ–Ω–¥ ‚ö†Ô∏è
  - `Favorite` (OneToMany) - –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ö†Ô∏è
  - `Image` (OneToMany, cascade) - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚úÖ

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ `contracts` –∏ `favorites` - —É—Ç–µ—á–∫–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞
- ‚ùå `CarModel` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (Brand, Model, CarClass)
- ‚ùå `gosNumber` –∏ `vin` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Value Objects —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –£–¥–∞–ª–∏—Ç—å `@OneToMany` —Å–≤—è–∑–∏ (contracts, favorites) - –Ω–∞—Ä—É—à–∞—é—Ç –≥—Ä–∞–Ω–∏—Ü—ã –∞–≥—Ä–µ–≥–∞—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞—Ç—å Value Objects: `VIN`, `GosNumber`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `@OneToMany` –¥–ª—è `Image` - —ç—Ç–æ —á–∞—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–∞
- ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç—å `CarModel` –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

---

#### Entity: **CarModel** (—á–∞—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–∞ Car)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Brand` (ManyToOne) - –±—Ä–µ–Ω–¥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
  - `Model` (ManyToOne) - –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
  - `CarClass` (ManyToOne) - –∫–ª–∞—Å—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è
  - `Car` (OneToMany) - —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π ‚ö†Ô∏è

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –°–º–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ - "–º–æ–¥–µ–ª—å" –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –±—Ä–µ–Ω–¥, –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–ª–∞—Å—Å, —Ç–∏–ø –∫—É–∑–æ–≤–∞
- ‚ùå –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–≤—è–∑—å —Å `Car`
- ‚ùå TODO –≤ –∫–æ–¥–µ: "–æ—Ç–¥–µ–ª–∏—Ç—å –±—Ä—ç–Ω–¥ –∏ –º–æ–¥–µ–ª—å"

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Value Objects –∏–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:
  - `BrandId` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –±—Ä–µ–Ω–¥
  - `ModelNameId` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
  - `CarClassId` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–ª–∞—Å—Å
  - `BodyType` - enum –¥–ª—è —Ç–∏–ø–∞ –∫—É–∑–æ–≤–∞
- ‚úÖ –£–¥–∞–ª–∏—Ç—å `@OneToMany` —Å–≤—è–∑—å —Å `Car`

---

#### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ Fleet Context:
- **Brand** (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –±—Ä–µ–Ω–¥–æ–≤) - –ø—Ä–æ—Å—Ç–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- **Model** (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –º–æ–¥–µ–ª–µ–π) - –ø—Ä–æ—Å—Ç–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- **CarClass** (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–ª–∞—Å—Å–æ–≤) - –ø—Ä–æ—Å—Ç–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- **CarState** (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π) - –º–æ–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ Value Object/Enum

---

### 3Ô∏è‚É£ **CLIENT CONTEXT (–ö–æ–Ω—Ç–µ–∫—Å—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤)** üü¢

#### Aggregate Root: **Client**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Role` (ManyToOne) - —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `Contract` (OneToMany) - –∏—Å—Ç–æ—Ä–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ ‚ö†Ô∏è
  - `Favorite` (OneToMany) - –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ ‚ö†Ô∏è
  - `Document` (—á–µ—Ä–µ–∑ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å) - –¥–æ–∫—É–º–µ–Ω—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
  - `RefreshToken` (—á–µ—Ä–µ–∑ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å) - —Ç–æ–∫–µ–Ω—ã
  - `VerificationCode` (—á–µ—Ä–µ–∑ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å) - –∫–æ–¥—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ —Å `Contract` –∏ `Favorite` - –Ω–∞—Ä—É—à–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
- ‚ùå `email`, `phone`, `login` - –ø—Ä–∏–º–∏—Ç–∏–≤—ã –≤–º–µ—Å—Ç–æ Value Objects
- ‚ùå –§–ª–∞–≥–∏ `deleted`, `banned`, `emailVerified` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∞—Å—Ç—å—é —Å—Ç–∞—Ç—É—Å–∞
- ‚ùå TODO: –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –£–¥–∞–ª–∏—Ç—å `@OneToMany` —Å–≤—è–∑–∏ (contracts, favorites)
- ‚úÖ –°–æ–∑–¥–∞—Ç—å Value Objects: `Email`, `Phone`, `Login`
- ‚úÖ –°–æ–∑–¥–∞—Ç—å `ClientStatus` (enum: ACTIVE, BANNED, DELETED, PENDING_VERIFICATION)
- ‚úÖ –ú–µ—Ç–æ–¥—ã: `ban()`, `unban()`, `verifyEmail()`, `delete()`

---

#### Entity: **Document** (—á–∞—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–∞ Client)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Client` (ManyToOne) - –≤–ª–∞–¥–µ–ª–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞
  - `DocumentType` (ManyToOne) - —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ü—Ä—è–º–∞—è —Å–≤—è–∑—å —Å `Client` - –º–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—Ü
- ‚ùå `verified` –∏ `deleted` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ, `Document` - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç —Å `ClientId`
- ‚úÖ –°–æ–∑–¥–∞—Ç—å `DocumentStatus` (PENDING, VERIFIED, REJECTED, DELETED)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã: `verify()`, `reject()`, `delete()`

---

#### Entity: **Favorite** (—Å–≤—è–∑—å M:N)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Client` (ManyToOne)
  - `Car` (ManyToOne)

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –°–≤—è–∑—ã–≤–∞–µ—Ç –¥–≤–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é
- ‚ùå –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫ –∫–∞–∫–æ–º—É –∞–≥—Ä–µ–≥–∞—Ç—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ, `Favorite` - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –∏–ª–∏ —á–∞—Å—Ç—å `Client`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ClientId` –∏ `CarId` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫
- ‚úÖ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ Client Context: `Client.addToFavorites(CarId)`

---

#### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ Client Context:
- **Role** - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ä–æ–ª–µ–π
- **DocumentType** - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

### 4Ô∏è‚É£ **IDENTITY CONTEXT (–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)** üü°

#### Entity: **RefreshToken**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Client` (ManyToOne) - –≤–ª–∞–¥–µ–ª–µ—Ü —Ç–æ–∫–µ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `Client` –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ClientId` –≤–º–µ—Å—Ç–æ `Client`
- ‚úÖ –ú–µ—Ç–æ–¥—ã: `revoke()`, `isExpired()`, `isValid()`

---

#### Entity: **VerificationCode**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - `Client` (ManyToOne) - –≤–ª–∞–¥–µ–ª–µ—Ü –∫–æ–¥–∞
  - `VerificationCodeType` (Enum) - —Ç–∏–ø –∫–æ–¥–∞ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `Client`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ClientId`
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã: `isExpired()`, `verify()`, `use()`

---

## üìà –ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

| –°—É—â–Ω–æ—Å—Ç—å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ | –¢–∏–ø —Å–≤—è–∑–∏ | –ü—Ä–æ–±–ª–µ–º–∞ |
|----------|-----------|----------------|-----------|----------|
| **Contract** | Client, Car, RentalState, Money | - | ManyToOne | ‚ùå –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç—ã |
| **Car** | CarModel, CarState, Money | Contract, Favorite, Image | ManyToOne + OneToMany | ‚ùå –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ |
| **Client** | Role | Contract, Favorite, Document, RefreshToken, VerificationCode | ManyToOne + OneToMany | ‚ùå –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ |
| **CarModel** | Brand, Model, CarClass | Car | ManyToOne + OneToMany | ‚ùå –°–º–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ |
| **Document** | Client, DocumentType | - | ManyToOne | ‚ö†Ô∏è –ì—Ä–∞–Ω–∏—Ü–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞ |
| **Favorite** | Client, Car | - | ManyToOne | ‚ùå –°–≤—è–∑—ã–≤–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã |
| **Image** | Car | - | ManyToOne | ‚úÖ –ß–∞—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–∞ |
| **RefreshToken** | Client | - | ManyToOne | ‚ùå –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ |
| **VerificationCode** | Client | - | ManyToOne | ‚ùå –°–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ |
| **Brand** | - | CarModel | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| **Model** | - | CarModel | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| **CarClass** | - | CarModel | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| **CarState** | - | Car | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| **RentalState** | - | Contract | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| **Role** | - | Client | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |
| **DocumentType** | - | Document | OneToMany | ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ |

---

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –∞–≥—Ä–µ–≥–∞—Ç–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ê–≥—Ä–µ–≥–∞—Ç—ã –Ω–∞–ø—Ä—è–º—É—é —Å—Å—ã–ª–∞—é—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞ —á–µ—Ä–µ–∑ `@ManyToOne`

**–ü—Ä–∏–º–µ—Ä—ã**:
```java
// Contract.java
@ManyToOne
private Client client;  // ‚ùå –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç

@ManyToOne
private Car car;  // ‚ùå –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç
```

**–†–µ—à–µ–Ω–∏–µ**:
```java
// Contract.java (DDD)
private ClientId clientId;  // ‚úÖ –¢–æ–ª—å–∫–æ ID
private CarId carId;        // ‚úÖ –¢–æ–ª—å–∫–æ ID
```

---

### 2. **–î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏**
**–ü—Ä–æ–±–ª–µ–º–∞**: `@OneToMany` —Å–æ–∑–¥–∞—ë—Ç —É—Ç–µ—á–∫—É –∞–≥—Ä–µ–≥–∞—Ç–∞ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

**–ü—Ä–∏–º–µ—Ä—ã**:
```java
// Car.java
@OneToMany(mappedBy = "car")
private List<Contract> contracts;  // ‚ùå –ù–µ –Ω—É–∂–Ω–æ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–∞

// Client.java
@OneToMany(mappedBy = "client")
private List<Contract> contracts;  // ‚ùå –ù–µ –Ω—É–∂–Ω–æ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–∞
```

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å `@OneToMany`, –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ Repository:
```java
// –í–º–µ—Å—Ç–æ car.getContracts()
List<Contract> contracts = contractRepository.findByCarId(car.getId());
```

---

### 3. **–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è –æ–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å**
**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∞–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–∏—Ç–∏–≤–∞–º–∏

**–ü—Ä–∏–º–µ—Ä—ã**:
```java
// Car.java
private String gosNumber;  // ‚ùå –î–æ–ª–∂–µ–Ω –±—ã—Ç—å GosNumber
private String vin;        // ‚ùå –î–æ–ª–∂–µ–Ω –±—ã—Ç—å VIN

// Client.java
private String email;      // ‚ùå –î–æ–ª–∂–µ–Ω –±—ã—Ç—å Email
private String phone;      // ‚ùå –î–æ–ª–∂–µ–Ω –±—ã—Ç—å Phone
```

**–†–µ—à–µ–Ω–∏–µ**: Value Objects —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
```java
public record VIN(String value) {
    public VIN {
        if (value == null || !value.matches("^[A-HJ-NPR-Z0-9]{17}$")) {
            throw new InvalidVINException(value);
        }
    }
}
```

---

### 4. **–ê–Ω–µ–º–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å**
**–ü—Ä–æ–±–ª–µ–º–∞**: –°—É—â–Ω–æ—Å—Ç–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**–ü—Ä–∏–º–µ—Ä—ã**:
```java
// Contract.java
@Setter  // ‚ùå –ü—É–±–ª–∏—á–Ω—ã–µ —Å–µ—Ç—Ç–µ—Ä—ã
private RentalState state;
```

**–†–µ—à–µ–Ω–∏–µ**: –ë–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥—ã
```java
// Contract.java (DDD)
public void confirm() {
    if (!canBeConfirmed()) {
        throw new InvalidStateTransitionException();
    }
    this.state = RentalState.CONFIRMED;
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É—â–Ω–æ—Å—Ç–µ–π | 16 | üü° |
| –ê–≥—Ä–µ–≥–∞—Ç—ã (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ) | 3 (Contract, Car, Client) | ‚úÖ |
| –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ | 7 | ‚úÖ |
| –ü—Ä—è–º—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏ | 4 (Contract‚ÜîClient, Contract‚ÜîCar, Favorite‚ÜîClient, Favorite‚ÜîCar) | ‚ùå |
| –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ | 8 | ‚ùå |
| Value Objects | 1 (Money) | ‚ùå –ú–∞–ª–æ |
| –°—É—â–Ω–æ—Å—Ç–µ–π —Å `@Setter` | 5 | ‚ùå |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)
1. ‚úÖ **–£–¥–∞–ª–∏—Ç—å –ø—Ä—è–º—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏** - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ ID
2. ‚úÖ **–£–¥–∞–ª–∏—Ç—å –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏** - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ ManyToOne –≤ JPA entities
3. ‚úÖ **–°–æ–∑–¥–∞—Ç—å Value Objects** - VIN, GosNumber, Email, Phone, RentalPeriod

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ)
4. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥—ã** - —É–±—Ä–∞—Ç—å —Å–µ—Ç—Ç–µ—Ä—ã –∏–∑ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
5. ‚úÖ **–†–∞–∑–¥–µ–ª–∏—Ç—å CarModel** - –≤—ã–¥–µ–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
6. ‚úÖ **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã Document –∏ Favorite** - —á–∞—Å—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–∞ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π?

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
7. ‚úÖ **–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã** - ClientStatus, DocumentStatus –≤–º–µ—Å—Ç–æ —Ñ–ª–∞–≥–æ–≤
8. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å Domain Events** - –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É BC
9. ‚úÖ **–ü—Ä–∏–º–µ–Ω–∏—Ç—å Specification Pattern** - –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

## üìê –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

```
RENTAL CONTEXT:
  Contract (Aggregate Root)
    ‚îú‚îÄ ContractId (Identity)
    ‚îú‚îÄ ClientId (Reference)
    ‚îú‚îÄ CarId (Reference)
    ‚îú‚îÄ RentalPeriod (Value Object)
    ‚îú‚îÄ Money (Value Object)
    ‚îî‚îÄ RentalState (Value Object/Enum)

FLEET CONTEXT:
  Car (Aggregate Root)
    ‚îú‚îÄ CarId (Identity)
    ‚îú‚îÄ VIN (Value Object)
    ‚îú‚îÄ GosNumber (Value Object)
    ‚îú‚îÄ CarModelId (Reference)
    ‚îú‚îÄ Money (Value Object)
    ‚îú‚îÄ CarState (Value Object)
    ‚îî‚îÄ List<Image> (Entities within aggregate)

CLIENT CONTEXT:
  Client (Aggregate Root)
    ‚îú‚îÄ ClientId (Identity)
    ‚îú‚îÄ Email (Value Object)
    ‚îú‚îÄ Phone (Value Object)
    ‚îú‚îÄ Login (Value Object)
    ‚îú‚îÄ Password (Value Object - hashed)
    ‚îú‚îÄ ClientStatus (Value Object)
    ‚îî‚îÄ RoleId (Reference)
    
  Document (Separate Aggregate? or part of Client?)
    ‚îú‚îÄ DocumentId (Identity)
    ‚îú‚îÄ ClientId (Reference)
    ‚îú‚îÄ DocumentTypeId (Reference)
    ‚îú‚îÄ DocumentNumber (Value Object)
    ‚îî‚îÄ DocumentStatus (Value Object)
```

---

## üîó Context Map (—Å–≤—è–∑–∏ –º–µ–∂–¥—É BC)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FLEET CONTEXT  ‚îÇ         ‚îÇ RENTAL CONTEXT  ‚îÇ
‚îÇ                 ‚îÇ         ‚îÇ                 ‚îÇ
‚îÇ  Car (Root)     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  Contract       ‚îÇ
‚îÇ  CarId          ‚îÇ  CarId  ‚îÇ  (Root)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚ñ≤
                                     ‚îÇ ClientId
                                     ‚îÇ
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ CLIENT CONTEXT  ‚îÇ
                            ‚îÇ                 ‚îÇ
                            ‚îÇ  Client (Root)  ‚îÇ
                            ‚îÇ  ClientId       ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚ñ≤
                                     ‚îÇ ClientId
                                     ‚îÇ
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ IDENTITY        ‚îÇ
                            ‚îÇ CONTEXT         ‚îÇ
                            ‚îÇ                 ‚îÇ
                            ‚îÇ  RefreshToken   ‚îÇ
                            ‚îÇ  VerificationCode‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–¢–∏–ø —Å–≤—è–∑–µ–π**: Customer-Supplier (—á–µ—Ä–µ–∑ ID)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏

–ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:

- [ ] –ê–≥—Ä–µ–≥–∞—Ç –∏–º–µ–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (Value Object)
- [ ] –°—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ –∞–≥—Ä–µ–≥–∞—Ç—ã - —á–µ—Ä–µ–∑ ID
- [ ] –ù–µ—Ç `@OneToMany` —Å–≤—è–∑–µ–π, –≤—ã—Ö–æ–¥—è—â–∏—Ö –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∞–≥—Ä–µ–≥–∞—Ç–∞
- [ ] –ü—Ä–∏–º–∏—Ç–∏–≤—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ Value Objects
- [ ] –ï—Å—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥—ã –≤–º–µ—Å—Ç–æ —Å–µ—Ç—Ç–µ—Ä–æ–≤
- [ ] –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏ –º–µ—Ç–æ–¥–∞—Ö
- [ ] –ù–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π JPA –≤ Domain –º–æ–¥–µ–ª–∏ (—Ç–æ–ª—å–∫–æ –≤ Infrastructure)
- [ ] –ï—Å—Ç—å —Ñ–∞–±—Ä–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
- **Aggregate Pattern** - –¥–ª—è Car, Client, Contract
- **Value Object Pattern** - –¥–ª—è VIN, Email, Money, RentalPeriod
- **Repository Pattern** - —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- **Domain Events** - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É BC
- **Specification Pattern** - –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (CarSearchCriteria)

### –ö–Ω–∏–≥–∏:
- "Domain-Driven Design" - Eric Evans
- "Implementing Domain-Driven Design" - Vaughn Vernon
- "Domain-Driven Design Distilled" - Vaughn Vernon

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 1.3 –∏–∑ `refactor_plan.md`

