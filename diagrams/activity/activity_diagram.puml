@startuml Activity_Diagram_Rental_Process
title Диаграмма активности: Процесс аренды автомобиля в системе каршеринга

|#AntiqueWhite|Клиент|
start

:Открыть каталог автомобилей;

:Применить фильтры
(бренд, модель, класс,
год, цена, даты);

:Просмотреть список
доступных автомобилей;

:Выбрать автомобиль;

:Просмотреть детали
(характеристики, фото,
цена за час);

if (Автомобиль подходит?) then (**ДА**)

  :Указать даты аренды
  (начало и конец);

  |#LightBlue|Система|

  :Проверить доступность
  автомобиля на выбранные даты;

  if (Доступен на эти даты?) then (**ДА**)

    :Рассчитать общую стоимость
    (цена × длительность);

    |#AntiqueWhite|Клиент|

    :Просмотреть расчет стоимости;

    if (Подтвердить создание заявки?) then (**ДА**)

      |#LightBlue|Система|

      :Создать Contract
      в статусе PENDING;

      :Установить статус Car
      на CONFIRMED;

      :Отправить email-уведомление
      администратору;

      |#LightGreen|Администратор|

      :Получить уведомление
      о новой заявке;

      :Открыть список заявок
      в статусе PENDING;

      :Проверить профиль клиента;

      :Проверить документы клиента
      (паспорт, водительское
      удостоверение);

      if (Документы в порядке?) then (**ДА**)

        :Подтвердить заявку
        (confirm contract);

        |#LightBlue|Система|

        :Изменить статус Contract
        на CONFIRMED;

        :Отправить email-уведомление
        клиенту об одобрении;

        |#Yellow|Планировщик|

        floating note right: Автоматизация через @Scheduled

        :Ожидать даты начала аренды
        (activateConfirmedContracts);

        :Изменить статус Contract
        на ACTIVE;

        :Изменить статус Car
        на ACTIVE;

        :Отправить уведомление
        клиенту о начале аренды;

        |#AntiqueWhite|Клиент|

        :Получить автомобиль;

        :Использовать автомобиль
        в течение срока аренды;

        |#Yellow|Планировщик|

        floating note right: Автоматическое завершение

        :Проверить окончание срока
        (completeActiveContracts);

        :Изменить статус Contract
        на COMPLETED;

        :Изменить статус Car
        на CLOSED;

        |#LightBlue|Система|

        :Провести инспекцию автомобиля;

        :Изменить статус Car
        на AVAILABLE;

        :Отправить уведомление
        клиенту о завершении;

        |#AntiqueWhite|Клиент|

        :Получить подтверждение
        завершения аренды;

        stop

      else (**НЕТ**)

        |#LightGreen|Администратор|

        :Отклонить заявку
        (cancel contract);

        |#LightBlue|Система|

        :Изменить статус Contract
        на CANCELLED;

        :Изменить статус Car
        на AVAILABLE;

        :Отправить email-уведомление
        клиенту с причиной отказа;

        |#AntiqueWhite|Клиент|

        :Получить уведомление
        об отказе;

        stop

      endif

    else (**НЕТ**)

      |#AntiqueWhite|Клиент|

      :Отменить создание заявки;

      stop

    endif

  else (**НЕТ**)

    |#LightBlue|Система|

    :Показать сообщение
    "Автомобиль недоступен
    на выбранные даты";

    |#AntiqueWhite|Клиент|

    if (Попробовать другие даты?) then (**ДА**)

      :Выбрать другие даты;

      -> Указать даты аренды\n(начало и конец);

    else (**НЕТ**)

      :Вернуться к каталогу;

      stop

    endif

  endif

else (**НЕТ**)

  |#AntiqueWhite|Клиент|

  :Выбрать другой автомобиль;

  -> Вернуться к каталогу\n(начало и конец);

endif

@enduml

