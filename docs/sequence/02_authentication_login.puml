@startuml Authentication Login
title Аутентификация (Вход)

skinparam backgroundColor white
skinparam sequenceArrowThickness 1
skinparam participant {
    BackgroundColor<<User>> #FFB6C1
    BackgroundColor<<Frontend>> #FFFACD
    BackgroundColor<<Server>> #ADD8E6
    BackgroundColor<<Database>> #E6E6FA
}

actor User <<User>>
participant "Frontend" as Frontend <<Frontend>>
participant "API" as API <<Server>>
database "Database" as DB <<Database>>

User -> Frontend: Вводит логин и пароль
Frontend -> API: POST /api/auth/login {email, password}

API -> DB: Поиск пользователя по email
DB --> API: Данные пользователя

alt Пользователь не найден
    API --> Frontend: 401 Unauthorized
    Frontend --> User: Показать ошибку "Неверные данные"

else Пользователь найден
    API -> API: Проверка пароля (BCrypt)

    alt Пароль неверный
        API --> Frontend: 401 Unauthorized
        Frontend --> User: Показать ошибку "Неверные данные"

    else Пароль верный
        API -> API: Проверка статуса аккаунта

        alt Аккаунт заблокирован или удалён
            API --> Frontend: 403 Forbidden
            Frontend --> User: Показать ошибку "Аккаунт заблокирован"

        else Аккаунт активен
            API -> API: Генерация JWT токена

            API -> DB: Сохранить refresh token
            DB --> API: Токен сохранён

            API --> Frontend: 200 OK + {token, user}
            Frontend -> Frontend: Сохранение токена в cookies
            Frontend --> User: Перенаправление на главную страницу
        end
    end
end

@enduml

